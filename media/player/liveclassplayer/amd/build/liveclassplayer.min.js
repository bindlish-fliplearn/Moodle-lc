define(["liveclassplayer","jquery","core/config","core/yui","core/log","module"],function(e,t,i,o,l,n){var a=null,s=function(e){var t=this,n={method:"POST",data:{sesskey:i.sesskey,event:JSON.stringify(e),id:a,title:t.getPlaylistItem().title,file:t.getPlaylistItem().file,position:t.getPosition(),bitrate:t.getCurrentQuality().bitrate},on:{failure:function(e){l.error(e)}}};"play"==e.type&&setTimeout(function(){n.data.position=t.getPosition()},10),"levelsChanged"==e.type&&(n.data.qualitylevel=JSON.stringify(t.getQualityLevels())),"audioTrackChanged"==e.type&&(n.data.audiotracks=JSON.stringify(t.getAudioTracks())),"captionsChanged"==e.type&&(n.data.captions=JSON.stringify(t.getCaptionsList())),o.io(i.wwwroot+"/media/player/liveclassplayer/eventlogger.php",n)},r=function(){var e=this;e.on("time",function(i){var o=i.currentTime,l=i.duration,n=a,s=window.location,r=s.host,d={view_time:o,duration:l,context_id:n,title:e.getPlaylistItem().title,file:e.getPlaylistItem().file};"localhost"==s.host&&(r=s.host+"/flip_moodle"),t.ajax({type:"POST",data:d,url:s.protocol+"//"+r+"/webservice/rest/server.php?wstoken=6257f654f905c94b0d0f90fce5b9af31&wsfunction=local_flipapi_guru_vedio_view&moodlewsrestformat=json",success:function(e){console.log(e),s.reload()}})})},d=function(e){var t=this.getPlaylistItem().title+" "+e.type+": "+e.message;l.error(t)};return{setupPlayer:function(i){if(window.liveclassplayer=window.liveclassplayer||e,n.config().licensekey&&(window.liveclassplayer.key=n.config().licensekey),a=i.logcontext,t("#"+i.playerid).length){var o=e(i.playerid);o.setup(i.setupdata),void 0!==i.downloadbtn&&o.addButton(i.downloadbtn.img,i.downloadbtn.tttext,function(){window.open(o.getPlaylistItem().file+"?forcedownload=true")},"download"),o.on("setupError",d),o.on("error",d),i.logevents.forEach(function(e){o.on(e,s),setInterval(r,3e4)})}}}});