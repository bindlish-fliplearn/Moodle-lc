define(["liveclassplayer","jquery","core/config","core/yui","core/log","module"],function(e,t,o,i,n,l){var a=null,s=function(e){var l=this,s={method:"POST",data:{sesskey:o.sesskey,event:JSON.stringify(e),id:a,title:l.getPlaylistItem().title,file:l.getPlaylistItem().file,position:l.getPosition(),bitrate:l.getCurrentQuality().bitrate},on:{failure:function(e){n.error(e)}}};setInterval(function(){l.on("time",function(e){console.log("response",e);var o=e.currentTime,i=e.duration,n=a,s=window.location,r=s.host,c={currentTime:o,duration:i,contextId:n,title:l.getPlaylistItem().title,file:l.getPlaylistItem().file};"localhost"==s.host&&(r=s.host+"/flip_moodle"),t.ajax({type:"POST",data:c,url:s.protocol+"//"+r+"/webservice/rest/server.php?wstoken=6257f654f905c94b0d0f90fce5b9af31&wsfunction=local_flipapi_upadte_completionexpected_by_id&moodlewsrestformat=json",success:function(e){console.log(e),s.reload()}})})},3e4),"play"==e.type&&setTimeout(function(){s.data.position=l.getPosition()},10),"levelsChanged"==e.type&&(s.data.qualitylevel=JSON.stringify(l.getQualityLevels())),"audioTrackChanged"==e.type&&(s.data.audiotracks=JSON.stringify(l.getAudioTracks())),"captionsChanged"==e.type&&(s.data.captions=JSON.stringify(l.getCaptionsList())),i.io(o.wwwroot+"/media/player/liveclassplayer/eventlogger.php",s)},r=function(e){var t=this.getPlaylistItem().title+" "+e.type+": "+e.message;n.error(t)};return{setupPlayer:function(o){if(window.liveclassplayer=window.liveclassplayer||e,l.config().licensekey&&(window.liveclassplayer.key=l.config().licensekey),a=o.logcontext,t("#"+o.playerid).length){var i=e(o.playerid);i.setup(o.setupdata),void 0!==o.downloadbtn&&i.addButton(o.downloadbtn.img,o.downloadbtn.tttext,function(){window.open(i.getPlaylistItem().file+"?forcedownload=true")},"download"),i.on("setupError",r),i.on("error",r),o.logevents.forEach(function(e){i.on(e,s)})}}}});