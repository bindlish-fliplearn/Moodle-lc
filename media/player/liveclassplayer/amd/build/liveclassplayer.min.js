define(["liveclassplayer","jquery","core/config","core/yui","core/log","module"],function(e,t,o,i,n,l){var a=null,s=1,r=function(e){var l=this,r={method:"POST",data:{sesskey:o.sesskey,event:JSON.stringify(e),id:a,title:l.getPlaylistItem().title,file:l.getPlaylistItem().file,position:l.getPosition(),bitrate:l.getCurrentQuality().bitrate},on:{failure:function(e){n.error(e)}}};setInterval(function(){s=1,l.on("time",function(e){console.log("response",e);var o=e.currentTime,i=e.duration,n=a,r=window.location,c=r.host,d={view_time:o,duration:i,context_id:n,title:l.getPlaylistItem().title,file:l.getPlaylistItem().file};"localhost"==r.host&&(c=r.host+"/flip_moodle"),1==s&&(s=0,t.ajax({type:"POST",data:d,url:r.protocol+"//"+c+"/webservice/rest/server.php?wstoken=6257f654f905c94b0d0f90fce5b9af31&wsfunction=local_flipapi_guru_vedio_view&moodlewsrestformat=json",success:function(e){console.log(e)}}))})},3e4),"play"==e.type&&setTimeout(function(){r.data.position=l.getPosition()},10),"levelsChanged"==e.type&&(r.data.qualitylevel=JSON.stringify(l.getQualityLevels())),"audioTrackChanged"==e.type&&(r.data.audiotracks=JSON.stringify(l.getAudioTracks())),"captionsChanged"==e.type&&(r.data.captions=JSON.stringify(l.getCaptionsList())),i.io(o.wwwroot+"/media/player/liveclassplayer/eventlogger.php",r)},c=function(e){var t=this.getPlaylistItem().title+" "+e.type+": "+e.message;n.error(t)};return{setupPlayer:function(o){if(window.liveclassplayer=window.liveclassplayer||e,l.config().licensekey&&(window.liveclassplayer.key=l.config().licensekey),a=o.logcontext,t("#"+o.playerid).length){var i=e(o.playerid);i.setup(o.setupdata),void 0!==o.downloadbtn&&i.addButton(o.downloadbtn.img,o.downloadbtn.tttext,function(){window.open(i.getPlaylistItem().file+"?forcedownload=true")},"download"),i.on("setupError",c),i.on("error",c),o.logevents.forEach(function(e){i.on(e,r)})}}}});